<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png"> -->

        <title>3 in a row</title>
    
        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="/styles/bootstrap.min.css">
    </head>
    
    <body>
        <div class="container">
            <header>3 in a row</header>
            <div class="row " rel="1">
                <div class="col-xs-4" rel="1">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="2">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="4">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
            </div>
            <div class="row" rel="2">
                <div class="col-xs-4" rel="8">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="16">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="32">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
            </div>
            <div class="row" rel="3">
                <div class="col-xs-4" rel="64">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="128">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
                <div class="col-xs-4" rel="256">
                    <a href="javascript:;" class="btn btn-default">[ ]</a>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="/js/jquery.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/js/game.js"></script>
        <script type="text/javascript">
            $(function() {
                var $wr = $('body');
                var game = new Game();

                $wr.on('reset', 'a.btn', function(e) {
                    $(this).attr('class', 'btn btn-default').html('[0]');
                });

                $wr.on('check', 'a.btn', function(e, data) {
                    $(this).addClass('disabled').html(data.checked);
                });

                $wr.on('winner', 'a.btn', function(e, data) {
                    var $this = $(this);
                    var id = $this.closest('.col-xs-4').attr('rel');
                    if ($.inArray(~~id, data.streak) >= 0) {
                        $this.addClass('btn-success');
                    }
                    $this.addClass('disabled');
                });

                $wr.on('draw', 'a.btn', function(e, data) {
                    $(this).addClass('btn-warning').addClass('disabled');
                });

                $wr.on('start', function(e) {
                    $('header').html('3 in a row - Start');
                    $('a.btn').trigger('reset');
                });
 
                $wr.on('gameover', function(e, gamedata) {
                    var result = gamedata.result;

                    $('a.btn').trigger('set', gamedata.board);

                    if (result.draw) {
                        $('header').html('3 in a row - Draw');
                        $('a.btn').trigger('draw', result);
                    } else {
                        $('header').html('3 in a row - Winner ' + result.winner);
                        $('a.btn').trigger('winner', result);
                    }
                });

                game.start('X', function() {
                    $wr.trigger('start');
                });

                $wr.on('click', 'a.btn', function(e) {
                    var $this = $(this);
                    var id = $this.closest('.col-xs-4').attr('rel');
                    game.check(id, function(err, over) {

                        $this.trigger('check', game.board[id]);
                        if (over) {
                            $wr.trigger('gameover', over);

                            // Restart game after some time
                            setTimeout(function() {
                                game.start(game.sign, function() {
                                    $wr.trigger('start');
                                });
                            }, 3000);
                        }
                    });
                });
            });
        </script>
    </body>
</html>